<!DOCTYPE html>
<html lang='ja'>
<head>
  <meta charset="utf-8">
  <title>ボタン探し</title>
  <style>
    .transparent-button {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      padding: 10px 20px;
      font-size: 16px;
      text-align: center;
      width: 100px;
      height: 50px;
      position: absolute;
      opacity: 0; /* ボタンを透明に */
    }
    .start-button, .pause-button, .reset-highscore-button, .rules-button, .mode-button, .message-toggle-button, .stop-button {
      position: fixed;
      left: 10px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      color: white;
    }
    .message-toggle-button {
      top: 10px;
      background-color: teal;
    }
    .reset-highscore-button {
      top: 70px;
      background-color: blue;
    }
    .mode-button {
      top: 130px;
      background-color: purple;
    }
    .rules-button {
      top: 190px;
      background-color: orange;
    }
    .pause-button {
      top: 250px;
      background-color: yellow;
      color: black;
    }
    .stop-button {
      top: 310px;
      background-color: red;
    }
    .start-button {
      top: 370px;
      background-color: green;
    }
    body, html {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background-color: black;
      color: white;
    }
    .position-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    #score, #timer, #highScore {
      position: fixed;
      font-size: 24px;
      color: white;
    }
    #score {
      top: 40px;
      right: 10px;
    }
    #timer {
      top: 70px;
      right: 10px;
    }
    #highScore {
      top: 10px;
      right: 10px;
    }
  </style>
</head>
<body>
  <div class="position-container">
    <button class="transparent-button" id="button" tabindex="-1"></button>
  </div>
  <div id="highScore">最高スコア: 0</div>
  <div id="score">ポイント: 0</div>
  <div id="timer">残り時間: 60秒</div>
  <button class="message-toggle-button" id="messageToggleButton">メッセージ表示: ON</button>
  <button class="reset-highscore-button" id="resetHighScoreButton">最高スコアリセット</button>
  <button class="mode-button" id="modeButton">モード変更</button>
  <button class="rules-button" id="rulesButton">ルール説明</button>
  <button class="pause-button" id="pauseButton">一時停止</button>
  <button class="stop-button" id="stopButton">中断</button>
  <button class="start-button" id="startButton">ゲームスタート</button>

  <script>
    let points = 0, timer = 60, gameStarted = false, countdownInterval, cheatMode = false, showMessage = true, isPaused = false;

    const updateHighScore = () => {
      const highestScore = localStorage.getItem('highestScore') || 0;
      document.getElementById('highScore').textContent = `最高スコア: ${highestScore}`;
    };

    const updateScore = () => {
      document.getElementById('score').textContent = `ポイント: ${points}`;
    };

    const updateTimer = () => {
      document.getElementById('timer').textContent = `残り時間: ${timer}秒`;
    };

    const startTimer = () => {
      countdownInterval = setInterval(() => {
        if (!isPaused) {
          timer--;
          updateTimer();
          if (timer <= 0) {
            clearInterval(countdownInterval);
            alert("時間終了！ あなたのポイント: " + points);
            saveScore();
            resetGame();
          }
        }
      }, 1000);
    };

    const moveButton = () => {
      const button = document.getElementById('button');
      const container = document.querySelector('.position-container');

      let validPosition = false;
      let newLeft, newTop;

      while (!validPosition) {
        newLeft = Math.random() * (container.offsetWidth - button.offsetWidth);
        newTop = Math.random() * (container.offsetHeight - button.offsetHeight);

        validPosition = !isOverlapping(newLeft, newTop, button.offsetWidth, button.offsetHeight);
      }

      button.style.left = `${newLeft}px`;
      button.style.top = `${newTop}px`;
    };

    const isOverlapping = (x, y, width, height) => {
      const fixedElements = document.querySelectorAll('button, #score, #timer, #highScore');
      for (let element of fixedElements) {
        const rect = element.getBoundingClientRect();
        if (
          x < rect.right &&
          x + width > rect.left &&
          y < rect.bottom &&
          y + height > rect.top
        ) {
          return true;
        }
      }
      return false;
    };

    const resetGame = () => {
      points = 0;
      timer = 60;
      gameStarted = false;
      isPaused = false;
      updateScore();
      updateTimer();
    };

    document.getElementById('button').addEventListener('click', () => {
      if (gameStarted && !isPaused) {
        points++;
        updateScore();
        moveButton();
        if (showMessage) {
          alert("みつけた！");
        }
      }
    });

    document.getElementById('resetHighScoreButton').addEventListener('click', () => {
      localStorage.removeItem('highestScore');
      updateHighScore();
      alert("最高スコアがリセットされました");
    });

    const saveScore = () => {
      if (cheatMode) {
        alert("チートモード中のため、最高スコアは保存されません！");
        return;
      }
      const highestScore = localStorage.getItem('highestScore') || 0;
      if (points > highestScore) {
        localStorage.setItem('highestScore', points);
        alert("新記録！ あなたの最高スコアは: " + points);
      }
      updateHighScore();
    };

    document.getElementById('startButton').addEventListener('click', () => {
      if (!gameStarted) {
        gameStarted = true;
        isPaused = false;
        startTimer();
        moveButton();
        updateScore();
        updateTimer();
        alert("ゲームがスタートしました！");
      } else {
        alert("すでにゲームが始まっています");
      }
    });

    document.getElementById('pauseButton').addEventListener('click', () => {
      if (gameStarted) {
        isPaused = !isPaused;
        alert(isPaused ? "ゲームが一時停止しました" : "ゲームが再開されました");
      } else {
        alert("ゲームが始まっていません！");
      }
    });

    document.getElementById('stopButton').addEventListener('click', () => {
      if (gameStarted) {
        clearInterval(countdownInterval);
        resetGame();
        alert("ゲームが中断されました");
      } else {
        alert("ゲームが始まっていません！");
      }
    });

    document.getElementById('rulesButton').addEventListener('click', () => {
      alert(`ルール:
1. 制限時間内に隠れたボタンをクリックして、できるだけ多くのポイントを獲得しましょう！
2. チートモードを有効にすると、ボタンが見やすくなりますが、最高スコアは記録されません。
3. 一時停止ボタンを使用すると、タイマーを止めてゲームを一時停止できます。
4. 中断ボタンでゲームを完全にリセットし、最初からやり直せます。`);
    });

    document.getElementById('modeButton').addEventListener('click', () => {
      if (gameStarted) {
        alert("ゲーム中はチートモードを切り替えられません！");
        return;
      }
      cheatMode = !cheatMode;
      const button = document.getElementById('button');
      button.style.opacity = cheatMode ? 0.5 : 0;
      button.style.border = cheatMode ? '2px solid white' : 'none';
      alert(cheatMode ? "チートモードが有効になりました！" : "チートモードが無効になりました！");
    });

    document.getElementById('messageToggleButton').addEventListener('click', () => {
      showMessage = !showMessage;
      document.getElementById('messageToggleButton').textContent = `メッセージ表示: ${showMessage ? "ON" : "OFF"}`;
    });

    window.onload = () => {
      updateScore();
      updateTimer();
      updateHighScore();
    };
  </script>
</body>
</html>
